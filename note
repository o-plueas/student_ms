Perfect â€” letâ€™s outline the **complete, step-by-step roadmap** to upgrade your Laravel **School/Student Management System** into a fully functional, professional-grade app with:
âœ… Auto userâ€“staff linking
âœ… Student admission number + RPin logic
âœ… Excel uploads
âœ… Role-based access (Admin, Teachers, Students, etc.)
âœ… Subject + Form Teacher allocations

---

## ðŸ§­ PHASE 1 â€” Setup & Configuration

### 1ï¸âƒ£ Install and Configure Laravel

If not already:

```bash
composer create-project laravel/laravel schoolms
cd schoolms
```

### 2ï¸âƒ£ Install Authentication (Breeze or Jetstream)

```bash
composer require laravel/breeze --dev
php artisan breeze:install
npm install && npm run dev
php artisan migrate
```

ðŸ‘‰ Gives you login/register/auth views & routes.

---

## ðŸ§­ PHASE 2 â€” Add Roles & Permissions (Spatie)

### 3ï¸âƒ£ Install Spatie Laravel Permission

```bash
composer require spatie/laravel-permission --prefer-source
```

### 4ï¸âƒ£ Publish and Migrate

```bash
php artisan vendor:publish --provider="Spatie\Permission\PermissionServiceProvider"
php artisan migrate
```

### 5ï¸âƒ£ Add the Trait to `User` model

```php
use Spatie\Permission\Traits\HasRoles;

class User extends Authenticatable
{
    use HasRoles;
}
```

### 6ï¸âƒ£ Seed Default Roles

Create a seeder:

```bash
php artisan make:seeder RoleSeeder
```

Add roles:

```php
use Spatie\Permission\Models\Role;

public function run()
{
    Role::create(['name' => 'admin']);
    Role::create(['name' => 'teacher']);
    Role::create(['name' => 'accountant']);
    Role::create(['name' => 'student']);
}
```

Run it:

```bash
php artisan db:seed --class=RoleSeeder
```

---

## ðŸ§­ PHASE 3 â€” Create Core Tables

### 7ï¸âƒ£ Migration: `students`

```bash
php artisan make:migration create_students_table
```

Example:

```php
Schema::create('students', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->string('admission_no')->unique();
    $table->string('rpin')->unique();
    $table->string('class');
    $table->string('section')->nullable();
    $table->timestamps();
});
```

---

### 8ï¸âƒ£ Migration: `staff`

```bash
php artisan make:migration create_staff_table
```

Example:

```php
Schema::create('staff', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->string('designation')->nullable();
    $table->decimal('salary', 12, 2)->nullable();
    $table->timestamps();
});
```

---

### 9ï¸âƒ£ Migration: `subjects` and `subject_teacher`

```bash
php artisan make:migration create_subjects_table
php artisan make:migration create_subject_teacher_table
```

Example:

```php
Schema::create('subjects', function (Blueprint $table) {
    $table->id();
    $table->string('name');
    $table->timestamps();
});

Schema::create('subject_teacher', function (Blueprint $table) {
    $table->id();
    $table->foreignId('subject_id')->constrained()->onDelete('cascade');
    $table->foreignId('teacher_id')->constrained('users')->onDelete('cascade');
    $table->string('class');
    $table->timestamps();
});
```

---

### ðŸ”Ÿ Migration: `form_teachers`

```bash
php artisan make:migration create_form_teachers_table
```

Example:

```php
Schema::create('form_teachers', function (Blueprint $table) {
    $table->id();
    $table->foreignId('teacher_id')->constrained('users')->onDelete('cascade');
    $table->string('class');
    $table->timestamps();
});
```

---

## ðŸ§­ PHASE 4 â€” Create Models and Relationships

### Students

```php
class Student extends Model {
    protected $fillable = ['user_id', 'admission_no', 'rpin', 'class', 'section'];

    public function user() {
        return $this->belongsTo(User::class);
    }
}
```

### Staff

```php
class Staff extends Model {
    protected $fillable = ['user_id', 'designation', 'salary'];

    public function user() {
        return $this->belongsTo(User::class);
    }
}
```

### Subject

```php
class Subject extends Model {
    protected $fillable = ['name'];

    public function teachers() {
        return $this->belongsToMany(User::class, 'subject_teacher', 'subject_id', 'teacher_id');
    }
}
```

---

## ðŸ§­ PHASE 5 â€” Logic Services

### 11ï¸âƒ£ Create a Student Service (Auto-Generate adno & rpin)

```bash
php artisan make:service StudentCreationService
```

In `/app/Services/StudentCreationService.php`:

```php
namespace App\Services;
use App\Models\Student;
use App\Models\User;
use Illuminate\Support\Facades\DB;

class StudentCreationService
{
    public function createStudent($data)
    {
        return DB::transaction(function() use ($data) {
            $user = User::create([
                'name' => $data['name'],
                'email' => $data['email'],
                'password' => bcrypt('password'),
            ]);
            $user->assignRole('student');

            $lastAdNo = Student::where('class', $data['class'])->latest('id')->value('admission_no');
            $serial = $lastAdNo ? (int)substr($lastAdNo, -2) + 1 : 1;
            $adno = sprintf('PSA/%s/%02d', now()->year, $serial);

            $rpin = $user->id . $user->id . substr($adno, -2);

            return Student::create([
                'user_id' => $user->id,
                'admission_no' => $adno,
                'rpin' => $rpin,
                'class' => $data['class'],
            ]);
        });
    }
}
```

---

## ðŸ§­ PHASE 6 â€” Controller Logic

### 12ï¸âƒ£ StudentController

```bash
php artisan make:controller StudentController
```

Example:

```php
public function store(Request $request, StudentCreationService $service)
{
    $validated = $request->validate([
        'name' => 'required',
        'email' => 'required|email|unique:users',
        'class' => 'required'
    ]);

    $student = $service->createStudent($validated);
    return back()->with('success', 'Student created with Admission No: '.$student->admission_no);
}
```

---

## ðŸ§­ PHASE 7 â€” Excel Import (Bulk Students)

Install:

```bash
composer require maatwebsite/excel
php artisan make:import StudentsImport --model=Student
```

Example in `StudentsImport`:

```php
public function model(array $row)
{
    return app(StudentCreationService::class)->createStudent([
        'name' => $row[0],
        'email' => $row[1],
        'class' => $row[2],
    ]);
}
```

---

## ðŸ§­ PHASE 8 â€” Staff Creation & Role Sync

In `StaffController`:

```php
public function store(Request $request)
{
    $validated = $request->validate([
        'name' => 'required',
        'email' => 'required|email|unique:users',
        'designation' => 'required',
        'role' => 'required',
    ]);

    DB::transaction(function() use ($validated) {
        $user = User::create([
            'name' => $validated['name'],
            'email' => $validated['email'],
            'password' => bcrypt('password'),
        ]);
        $user->assignRole($validated['role']);

        Staff::create([
            'user_id' => $user->id,
            'designation' => $validated['designation'],
            'salary' => $validated['salary'] ?? null,
        ]);
    });

    return back()->with('success', 'Staff created successfully!');
}
```

---

## ðŸ§­ PHASE 9 â€” Subject Allocation

In `SubjectController`:

```php
public function assignTeacher(Request $request)
{
    $request->validate([
        'subject_id' => 'required',
        'teacher_id' => 'required|array',
        'class' => 'required',
    ]);

    foreach ($request->teacher_id as $teacher) {
        DB::table('subject_teacher')->insert([
            'subject_id' => $request->subject_id,
            'teacher_id' => $teacher,
            'class' => $request->class,
        ]);
    }

    return back()->with('success', 'Subjects assigned successfully');
}
```

---

## ðŸ§­ PHASE 10 â€” Form Teacher Allocation

```php
public function assignFormTeacher(Request $request)
{
    $request->validate([
        'teacher_id' => 'required',
        'class' => 'required',
    ]);

    FormTeacher::updateOrCreate(
        ['class' => $request->class],
        ['teacher_id' => $request->teacher_id]
    );

    return back()->with('success', 'Form teacher assigned!');
}
```

---

## ðŸ§­ PHASE 11 â€” Views & Dashboards

Now build:

* `/resources/views/students/create.blade.php`
* `/resources/views/staff/create.blade.php`
* `/resources/views/subjects/assign.blade.php`
* `/resources/views/formteacher/assign.blade.php`

Each with dropdowns pulling from the `users` table where role = 'teacher'.

---

## ðŸ§­ PHASE 12 â€” Testing & Validation

âœ… Test single student creation
âœ… Test Excel import
âœ… Test automatic admission_no and RPin generation
âœ… Test staff creation with auto role
âœ… Test subject allocation
âœ… Test form teacher assignment

---

## ðŸ§  BONUS

Add audit logs, attendance, exams, and payment modules next â€” easily built on top of this base.

---

Would you like me to generate **all the real code files** (controllers, service, migrations, and Blade templates) for this setup in a ZIP you can download and run in your Laravel app?
